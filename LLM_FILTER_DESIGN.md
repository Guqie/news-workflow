# 大模型精细筛选模块设计方案

## 一、模块架构

```
输入: 经过关键词+规则筛选的新闻（337条）
  ↓
大模型筛选器 (LLMFilter)
  ↓
输出: 高质量新闻 + 筛选报告
```

## 二、核心功能

### 2.1 模块结构
```
llm_filter.py
├── LLMFilter 类
│   ├── __init__()           # 初始化（配置大模型）
│   ├── filter_single()      # 单条新闻筛选
│   ├── filter_batch()       # 批量筛选
│   └── generate_report()    # 生成筛选报告
```

### 2.2 配置文件
```json
{
  "model": "claude-sonnet-4",
  "batch_size": 10,
  "max_retries": 3,
  "timeout": 30
}
```

## 三、判断标准

大模型需要判断新闻是否属于以下类型：
1. ✅ 保留：高质量、相关的新闻
2. ❌ 排除：
   - 软文/广告
   - 标题党/低质量
   - 与战略新兴产业/高科技无关
   - 纯粹的股市分析/投资建议

## 四、提示词设计

### 4.1 系统提示词
```
你是一个新闻质量评估专家，专注于战略新兴产业和高科技产业领域。
你的任务是判断新闻是否值得保留。

保留标准：
- 政策动态（部委、地方政府政策）
- 龙头企业动态（投融资、战略合作、技术突破）
- 重大技术突破（商业化应用、全球/全国首创）
- 产业趋势分析
- 重点数据（市场规模、增长率）

排除标准：
- 软文/广告/推广内容
- 标题党/低质量内容
- 纯粹的股市分析/投资建议
- 与战略新兴产业/高科技无关的内容
```

### 4.2 用户提示词模板（一次性处理）
```
请判断以下新闻列表中每条新闻是否值得保留。

新闻列表：
[
  {"id": 1, "title": "标题1", "source": "来源1"},
  {"id": 2, "title": "标题2", "source": "来源2"},
  ...
]

请返回JSON数组，格式如下：
[
  {"id": 1, "keep": true, "reason": "政策动态"},
  {"id": 2, "keep": false, "reason": "软文广告"},
  ...
]

注意：
1. 必须返回所有新闻的判断结果
2. id必须与输入一致
3. reason简短说明（5-10字）
```

## 五、批量处理策略

### 推荐方案：一次性处理（用户建议）

**优点：**
- ✅ 只需1次API调用
- ✅ 成本最低（$0.02-0.05/次）
- ✅ 速度最快（1-2分钟）
- ✅ 大模型可以整体判断，避免重复

**可行性分析：**
- 337条标题 × 平均80字 ≈ 27,000字
- 约10,000 tokens（输入）
- Claude Sonnet 4上下文：200K tokens
- ✅ 完全可以一次性处理

**输入格式：**
```json
[
  {"id": 1, "title": "标题1", "source": "来源1"},
  {"id": 2, "title": "标题2", "source": "来源2"},
  ...
]
```

**输出格式：**
```json
[
  {"id": 1, "keep": true, "reason": "政策动态"},
  {"id": 2, "keep": false, "reason": "软文广告"},
  ...
]
```

## 六、成本分析

### 单次运行成本（337条新闻）
- **一次性处理：约 $0.02-0.05**
- 每月运行20次：约 $0.4-1/月
- 每年成本：约 $5-12/年

### 成本对比
- 原批量方案：$0.68/次
- 一次性处理：$0.02-0.05/次
- **节省：93%成本**

### 成本优化建议
1. ✅ 一次性处理所有新闻（已采用）
2. 只对规则筛选后的新闻使用大模型
3. 定期评估效果，调整规则减少大模型调用

## 七、实现步骤

### 第一步：创建模块
```python
# llm_filter.py
class LLMFilter:
    def __init__(self, model="claude-sonnet-4")
    def filter_all(self, news_list)  # 一次性处理所有新闻
    def parse_result(self, response)  # 解析返回的JSON数组
```

### 第二步：测试
- 先用10条新闻测试提示词
- 验证输出格式正确
- 调整参数

### 第三步：全量运行
- 一次性处理337条新闻
- 解析返回的JSON数组
- 生成筛选报告
- 评估效果

### 第四步：优化
- 根据结果调整提示词
- 记录误判案例
- 持续改进

## 八、注意事项

### 8.1 错误处理
- API调用失败 → 重试3次
- 超时 → 记录并跳过
- 返回格式错误 → 使用默认值

### 8.2 质量控制
- 记录所有判断结果
- 定期抽查验证准确率
- 根据反馈调整提示词

### 8.3 性能优化
- 使用异步并发处理
- 缓存已处理的新闻
- 避免重复调用

## 九、总结

### 推荐方案
**一次性处理所有新闻**
- 成本：$0.02-0.05/次（337条）
- 耗时：1-2分钟
- 准确率：预计85-90%
- 节省成本：93%（vs 批量方案）

### 优势
1. ✅ 成本极低
2. ✅ 速度最快
3. ✅ 实现简单
4. ✅ 大模型可整体判断

### 下一步
1. 实现 llm_filter.py 模块
2. 小规模测试（10条）
3. 全量测试（337条）
4. 评估效果并优化

---

**设计完成时间：** 2026-02-11
**更新：** 采用一次性处理方案
